<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chatbot - Trải nghiệm tức thì</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --bg-main: #0f1116;
    --bg-card: #1a1d23;
    --text: #f1f1f1;
    --primary: #4a90e2;
    --primary-hover: #357abd;
    --border: #2c2f36;
    --chat-user: #4a90e2;
    --chat-ai: #2b2f36;
}

* { box-sizing: border-box; }
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: var(--bg-main);
    color: var(--text);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.chat-container {
    width: 100%;
    max-width: 900px;
    height: 100%;
    max-height: 95vh;
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    animation: fadeIn 0.5s ease;
}
@keyframes fadeIn { from{opacity:0; transform:scale(0.97);} to{opacity:1; transform:scale(1);} }
.header {
    background: var(--primary);
    padding: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    font-size: 1.3rem;
    font-weight: 700;
    position: relative;
}
.header .fa-robot { animation: pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.1);} }
.logout-btn {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
}
.logout-btn:hover { color: var(--bg-card); }
.chat-box {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    scroll-behavior: smooth;
}
.message {
    display: flex;
    align-items: flex-start;
    animation: slideIn 0.3s ease;
}
@keyframes slideIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }
.message-content {
    padding: 0.8rem 1.2rem;
    border-radius: 16px;
    max-width: 80%;
    line-height: 1.5;
    word-wrap: break-word;
}
.user .message-content {
    background: var(--chat-user);
    color: #fff;
    border-bottom-right-radius: 4px;
    margin-left: auto;
}
.ai .message-content {
    background: var(--chat-ai);
    color: var(--text);
    border-bottom-left-radius: 4px;
}
.input-area {
    display: flex;
    gap: 0.5rem;
    padding: 0.8rem;
    border-top: 1px solid var(--border);
    background: var(--bg-card);
}
.input-area input {
    flex: 1;
    border: none;
    border-radius: 25px;
    padding: 0.7rem 1.2rem;
    background: var(--bg-main);
    color: var(--text);
}
.input-area input:focus { outline: 2px solid var(--primary); }
.input-area button {
    background: var(--primary);
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
}
.input-area button:hover { background: var(--primary-hover); }
.api-key-setup {
    padding: 2rem;
    text-align: center;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 1rem;
}
.api-key-input {
    padding: 0.7rem 1rem;
    border-radius: 25px;
    border: 1px solid var(--border);
    background: var(--bg-main);
    color: var(--text);
}
.api-key-input:focus { outline: 2px solid var(--primary); }
.btn-primary {
    background: var(--primary);
    border: none;
    padding: 0.6rem 1.4rem;
    border-radius: 25px;
    font-weight: 600;
}
.btn-primary:hover { background: var(--primary-hover); }
@media (max-width: 768px) {
    .chat-container { border-radius: 0; max-height: 100vh; }
    .message-content { max-width: 90%; font-size: 0.95rem; }
}
</style>
</head>
<body>

<div class="chat-container">
    <div class="api-key-setup" id="api-key-setup-div">
        <h2>Thiết lập API Key</h2>
        <p>Vui lòng dán API Key của OpenAI để bắt đầu trò chuyện.<br>Key chỉ được lưu trong trình duyệt của bạn.</p>
        <input type="password" class="api-key-input" id="api-key-input" placeholder="Dán API Key của bạn vào đây">
        <button class="btn btn-primary" id="save-key-btn">Lưu và Bắt đầu</button>
    </div>

    <div class="chat-interface" id="chat-interface-div" style="display: none; flex-direction: column; height: 100%;">
        <div class="header">
            <i class="fa-solid fa-robot"></i> AI Chatbot
            <button class="logout-btn" id="logout-btn"><i class="fa-solid fa-right-from-bracket"></i></button>
        </div>
        <div class="chat-box" id="chat-box">
            <div class="message ai">
                <div class="message-content">Chào bạn! Tôi là một trợ lý AI. Bạn muốn trò chuyện về điều gì?</div>
            </div>
        </div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Nhập tin nhắn của bạn...">
            <button id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script>
const API_KEY_STORAGE_KEY = 'openaiApiKey';
const apiKeySetupDiv = document.getElementById('api-key-setup-div');
const chatInterfaceDiv = document.getElementById('chat-interface-div');
const apiKeyInput = document.getElementById('api-key-input');
const saveKeyBtn = document.getElementById('save-key-btn');
const logoutBtn = document.getElementById('logout-btn');
const chatBox = document.getElementById('chat-box');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
let API_KEY = '';

function loadApiKey() {
    API_KEY = localStorage.getItem(API_KEY_STORAGE_KEY);
    if (API_KEY) {
        apiKeySetupDiv.style.display = 'none';
        chatInterfaceDiv.style.display = 'flex';
    } else {
        apiKeySetupDiv.style.display = 'flex';
        chatInterfaceDiv.style.display = 'none';
    }
}
saveKeyBtn.addEventListener('click', () => {
    const key = apiKeyInput.value.trim();
    if (key) {
        localStorage.setItem(API_KEY_STORAGE_KEY, key);
        loadApiKey();
    } else {
        alert('Vui lòng nhập API Key.');
    }
});
logoutBtn.addEventListener('click', () => {
    localStorage.removeItem(API_KEY_STORAGE_KEY);
    apiKeyInput.value = '';
    loadApiKey();
    chatBox.innerHTML = `<div class="message ai"><div class="message-content">Chào bạn! Tôi là một trợ lý AI. Bạn muốn trò chuyện về điều gì?</div></div>`;
});
async function sendMessage() {
    const message = userInput.value.trim();
    if (!message) return;
    appendMessage(message, 'user');
    userInput.value = '';
    const thinkingMessage = appendMessage('...', 'ai');
    try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: 'gpt-3.5-turbo',
                messages: [{ role: 'user', content: message }],
                max_tokens: 150
            })
        });
        if (!res.ok) {
            const errData = await res.json();
            throw new Error(errData.error.message || 'Lỗi API.');
        }
        const data = await res.json();
        thinkingMessage.querySelector('.message-content').innerText = data.choices[0].message.content.trim();
    } catch (err) {
        thinkingMessage.querySelector('.message-content').innerText = `Lỗi: ${err.message}`;
    }
    chatBox.scrollTop = chatBox.scrollHeight;
}
function appendMessage(text, sender) {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', sender);
    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');
    contentDiv.innerText = text;
    msgDiv.appendChild(contentDiv);
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
    return msgDiv;
}
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
window.addEventListener('DOMContentLoaded', loadApiKey);
</script>
</body>
</html>