<!DOCTYPE html>
<html lang="vi">
<head>
<link rel="stylesheet" href="styles.css"> 

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tạo QR Liên Kết (Phiên Bản Cá Nhân)</title>
  
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css"> 
</head>
<body>
  <button class="menu-toggle" onclick="document.querySelector('.side-menu').classList.toggle('open')">
    <i class="fas fa-bars"></i>
  </button>
  
  <div class="side-menu">
    
      <a href="index.html">Trang Chủ</a>
      <a href="banggia.html">Bảng Giá</a>
      <a href="khodv.html">Kho Dịch Vụ Khách</a>
      <a href="khoad.html">Kho Dịch Vụ Admin</a>
      <a href="taoqr.html">Tạo QR từ link</a>
      <a href="muachu.html">Mưa Chữ</a>
    <a href="share.html">Nguồn Tài Nguyên Miễn Phí</a>
   </div>

  <h1>✨ Tạo QR Liên Kết ✨</h1>
  <input type="text" id="link-input" placeholder="Nhập link tại đây ví dụ: https://trongnghia1759.github.io/">
  <div class="color-picker">
    Màu QR: <input type="color" id="color-picker" value="#00f7ff">
  </div>
  <br>
  
  <button class="qr-button generate" onclick="generateQR()">
    <i class="fas fa-magic"></i> Tạo QR
  </button>
  <button class="qr-button" onclick="clearQR()">
    <i class="fas fa-times-circle"></i> Xóa QR
  </button>

  <div id="qr-container"></div>
  <a id="download-link" class="download-link" download="qr-code.png" style="display:none;">
    <i class="fas fa-download"></i> Tải QR về máy
  </a>
  
  <div id="music-bot" class="music-bot" onclick="toggleMusic()">
    <i class="fas fa-compact-disc"></i>
    <span>🎵 Nghe Nhạc Chill</span>
  </div>
  
  <audio id="chill-music" loop>
    <source src="placeholder.mp3" type="audio/mpeg"> 
  </audio>


  <div class="footer">
    ⚠️ Link sai vẫn tạo QR nhưng không quét được <br><br>
    FB: Đàm Trọng Nghĩa (Bo)<br>
    TikTok: bo1759
  </div>

  <script>
    // GIỮ NGUYÊN CHỨC NĂNG TẠO QR CỦA FILE GỐC
    function generateQR() {
      const link = document.getElementById("link-input").value.trim();
      const color = document.getElementById("color-picker").value;
      const qrContainer = document.getElementById("qr-container");
      const downloadLink = document.getElementById("download-link");

      qrContainer.innerHTML = "";
      downloadLink.style.display = "none";

      if (link === "") {
        alert("🌸 Vui lòng nhập liên kết.");
        return;
      }

      const canvas = document.createElement("canvas");
      // Sử dụng thư viện QRCode.js
      QRCode.toCanvas(canvas, link, {
        color: {
          dark: color,
          light: "#00000000" // nền trong suốt
        },
        width: 256
      }, function (error) {
        if (error) {
          console.error(error);
          alert("⚠️ Lỗi khi tạo mã QR!");
        } else {
          qrContainer.appendChild(canvas);
          downloadLink.href = canvas.toDataURL("image/png");
          downloadLink.style.display = "inline-block";
        }
      });
    }

    function clearQR() {
      document.getElementById("qr-container").innerHTML = "";
      document.getElementById("download-link").style.display = "none";
    }

    // Enter để tạo QR
    document.getElementById("link-input").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        generateQR();
      }
    });
    
    // CHỨC NĂNG MUSIC BOT MỚI
    const musicBot = document.getElementById('music-bot');
    const chillMusic = document.getElementById('chill-music');

    function toggleMusic() {
      // Kiểm tra xem đã thêm nguồn nhạc chưa
      // Việc thêm thẻ <source> trong HTML đã khắc phục được lỗi này, nhưng giữ lại check để phòng trường hợp lỗi load file
      if (chillMusic.hasChildNodes() && chillMusic.querySelector('source').getAttribute('src') !== 'placeholder.mp3') {
          if (chillMusic.paused) {
            chillMusic.play();
            musicBot.classList.add('playing');
            musicBot.querySelector('span').textContent = '🔊 Đang Phát Nhạc...';
          } else {
            chillMusic.pause();
            musicBot.classList.remove('playing');
            musicBot.querySelector('span').textContent = '🎵 Nghe Nhạc Chill';
          }
      } else {
          alert('🎶 Vui lòng thay đổi "placeholder.mp3" bằng đường dẫn file nhạc của bạn trong thẻ <audio> để kích hoạt chức năng này!');
      }
    }
  </script>
</body>
</html>
